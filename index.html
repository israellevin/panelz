<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
        <meta charset="utf-8"/>
        <title>panelz</title>
        <link rel="stylesheet" type="text/css" href="normalize.css" />
        <link rel="stylesheet" type="text/css" href="panelz.css" />
        <script type="text/javascript" src="jquery.min.js"></script>
        <script type="text/javascript" src="jstween-1.1.min.js"></script>
        <script type="text/javascript" src="panelz.js"></script>
        <script type="text/javascript">

// When the DOM is ready
$(function(){
    // we bind the file input
    $('#fileSel').change(function(e){
        var fileReader = new FileReader();
        // to set the textarea,
        fileReader.onload = function(e){
            $('#scriptArea').val(e.target.result);
        };
        fileReader.readAsText(e.target.files[0], "UTF-8");
    });
    // and the run button.
    $('#runBtn').click(function(e){

        // Before we do anything rash, we collect some data
        var area = $('#scriptArea');
        var script = area.val();
        var cursor = area.get(0).selectionStart;
        // so we can figure out how many go commands (empty lines) are before the cursor (if you are using a supportive browser).
        var gos = cursor ? script.substr(0, cursor).match(/[^\n]*\n\n[^\n]*/gi) : false;
        gos = gos ? 1 + gos.length : 1;

        // Now we can init panelz inside the #panelz div with the script in the textarea,
        panelz.load($('#panelz'), $('#scriptArea').val());
        // and forward the Story to the cursor's line
        for(var x = 0; x < gos; (x++)) Canvas.go(1);
        // and bind the keys for the UI
        $(document).keydown(function(e){

            // For now, we ignore key presses when the Canvas is busy. TODO In the future we will do something cleverer, like a queue or acceleration.
            if(panelz.busy) return true;

            // Right arrow and space go forward.
            if(39 === e.which || 32 === e.which){
                panelz.go(1);

            // Left arrow goes back.
            }else if(37 === e.which){
                panelz.go(-1);

            // 'q' quits the show
            }else if(81 === e.which){
                panelz.unload();
                // and unbinds the UI
                $(document).off('keypress');

            // Anything else will log itself, to make it easier for me to bind new keys to new functions, and return true so that someone else will handle it.
            }else{
                console.log('unknown key', e.which);
                return true;
            }

            // If the keystroke was recognized as a command and handled, we return false, to stop propagation.
            return false;
        });
    });
});
        </script>
    </head>
    <body>
        <a href="https://github.com/israellevin/panelz"><img style="position: absolute; top: 0; right: 0; border: 0; z-index:100;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Panelz on GitHub"></a>
        <div id="panelz">
            <div style="position: absolute; bottom: 0px; right: 0px; text-align: center;">
                Load:
                <input id="fileSel" type="file">
                <input id="runBtn" type="button" value="Run">
            </div>
            <textarea id="scriptArea" style="width: 100%; height: 100%;">
]noborder
:<h3>Welcome to the <a href="http://github.com/israellevin/panelz">Panelz</a> showcase</h3>
]noborder:0 0 3 0
Panelz is a brave new way to tell stories, mostly influenced by comics.
:Hit the space key for a more in depth explanation, or check out works in progress below.
]wide:100 100 3 0
:Works in progress:
<br>
<ul>
    <li><a href="six/index.html">Six</a> - documenting a one-on-one role-playing game</li>
    <li><a href="smadar/index.html">Smadar</a> - trying to spread a Hebrew poem on Panelz</li>
    <li><a href="fall/index.html">The Fall</a> - Persephone goes to the underworls</li>
</ul>
~

]:1000 0 1 0
:Sweet. You just learned the most important thing about Panelz: hitting the space key. Try it again.

]
:See? Every time you hit space the story advances.

]
:And this time you did it all on your own.

]
:The right arrow works as well.

]
:And you'll never guess what the left arrow does.

]
:That's all I have for now. I suggest you use that left arrow to go back and check the samples at the beginning.

]
:Really, from here on it's just random tests that might, one day, turn into our test suite.

]
Testing panelz
]:0 0 2.5 0.5
appendages

thought: Will it work?

bleft: It might.

bright: It will!

+thought green: It does.

+thought big:

+thought bleft: And back as well!
            </textarea>
        </div>
    </body>
</html>
